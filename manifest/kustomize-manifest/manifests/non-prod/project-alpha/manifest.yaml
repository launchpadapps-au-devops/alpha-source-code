apiVersion: v1
kind: Service
metadata:
  name: alpha-backend-api-gateway-v1-service
  namespace: alpha
spec:
  ports:
  - port: 3000
    protocol: TCP
    targetPort: 3000
  selector:
    app: alpha-backend-api-gateway-v1-deployment
  type: LoadBalancer
---
apiVersion: v1
kind: Service
metadata:
  name: alpha-backend-cms-ms-v1-service
  namespace: alpha
spec:
  ports:
  - port: 3003
    protocol: TCP
    targetPort: 3003
  selector:
    app: alpha-backend-cms-ms-v1-deployment
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: alpha-backend-health-ms-v1-service
  namespace: alpha
spec:
  ports:
  - port: 3004
    protocol: TCP
    targetPort: 3004
  selector:
    app: alpha-backend-health-ms-v1-deployment
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: alpha-backend-notification-ms-v1-service
  namespace: alpha
spec:
  ports:
  - port: 3002
    protocol: TCP
    targetPort: 3002
  selector:
    app: alpha-backend-notification-ms-v1-deployment
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: alpha-backend-user-ms-v1-service
  namespace: alpha
spec:
  ports:
  - port: 3001
    protocol: TCP
    targetPort: 3001
  selector:
    app: alpha-backend-user-ms-v1-deployment
  type: ClusterIP
---
apiVersion: v1
kind: Service
metadata:
  name: alpha-rabbitmq-service
  namespace: alpha
spec:
  ports:
  - port: 5672
    protocol: TCP
    targetPort: 5672
  selector:
    app: alpha-rabbitmq
  type: ClusterIP
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-backend-api-gateway-v1-deployment
  name: alpha-backend-api-gateway-v1-deployment
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-backend-api-gateway-v1-deployment
  template:
    metadata:
      labels:
        app: alpha-backend-api-gateway-v1-deployment
    spec:
      containers:
      - env:
        - name: NODE_ENV
          value: local
        - name: PORT
          value: "3000"
        - name: APP_NAME
          value: alpha-api-gateway
        - name: APP_API_PREFIX
          value: /api/gateway/v1
        - name: APP_DEBUG
          value: "true"
        - name: JWT_SECRET
          value: secret
        - name: JWT_EXPIRES_IN
          value: 1d
        - name: HEALTH_SERVICE_BASE_URL
          value: http://alpha-backend-health-ms-v1-service:3004
        - name: HEALTH_SERVICE_API_PREFIX
          value: /api/health-ms/v1
        - name: USER_SERVICE_BASE_URL
          value: http://alpha-backend-user-ms-v1-service:3001
        - name: USER_SERVICE_API_PREFIX
          value: /api/user-ms/v1
        - name: CMS_SERVICE_BASE_URL
          value: http://alpha-backend-cms-ms-v1-service:3003
        - name: CMS_SERVICE_API_PREFIX
          value: /api/content-ms/v1
        - name: DB_HOST
          value: alpha-postgressql.postgres.database.azure.com
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: alphaadmin
        - name: DB_PASSWORD
          value: alphaadminpasswd543
        - name: DB_NAME
          value: alpha_database
        - name: RABBITMQ_HOST
          value: alpha-rabbitmq-service
        - name: RABBITMQ_PORT
          value: "5672"
        - name: RABBITMQ_USERNAME
          value: guest
        - name: RABBITMQ_PASSWORD
          value: guest
        - name: RABBITMQ_QUEUE
          value: apigateway_queue
        - name: SUPER_ADMIN_TOKEN
          value: '@su93r@dm1n'
        - name: NOTFICATION_SERVICE_BASE_URL
          value: http://alpha-backend-notification-ms-v1-service:3002
        - name: NOTFICATION_SERVICE_API_PREFIX
          value: /api/notification-ms/v1
        image: alphadev.azurecr.io/alpha-backend-api-gateway-v1@sha256:ef9a827a8ee360a41ba33cfd4cd73abc5a24a4bec8081fc6ffb01faf87f13cd2
        imagePullPolicy: IfNotPresent
        name: alpha-backend-api-gateway-v1-container
        ports:
        - containerPort: 3000
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z alpha-rabbitmq-service 5672; do echo waiting for rabbitmq ;
          sleep 2; done;
        image: busybox:1.28
        name: wait-for-rabbitmq
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-backend-cms-ms-v1-deployment
  name: alpha-backend-cms-ms-v1-deployment
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-backend-cms-ms-v1-deployment
  template:
    metadata:
      labels:
        app: alpha-backend-cms-ms-v1-deployment
    spec:
      containers:
      - env:
        - name: NODE_ENV
          value: local
        - name: PORT
          value: "3003"
        - name: APP_NAME
          value: alpha-content-ms-v1
        - name: APP_API_PREFIX
          value: /api/content-ms/v1
        - name: APP_DEBUG
          value: "true"
        - name: JWT_SECRET
          value: secret
        - name: JWT_EXPIRES_IN
          value: 1d
        - name: HEALTH_SERVICE_BASE_URL
          value: http://alpha-backend-user-ms-v1-service:3001
        - name: HEALTH_SERVICE_API_PREFIX
          value: /api/v1/health
        - name: DB_HOST
          value: alpha-postgressql.postgres.database.azure.com
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: alphaadmin
        - name: DB_PASSWORD
          value: alphaadminpasswd543
        - name: DB_NAME
          value: alpha_database
        - name: RABBITMQ_HOST
          value: alpha-rabbitmq-service
        - name: RABBITMQ_PORT
          value: "5672"
        - name: RABBITMQ_USERNAME
          value: guest
        - name: RABBITMQ_PASSWORD
          value: guest
        - name: RABBITMQ_QUEUE
          value: cms_queue
        image: alphadev.azurecr.io/alpha-backend-cms-ms-v1@sha256:34348997cfdc0fc03c5640ed8b6b3141d13e279bed22fc52effe211ddd5bf686
        name: alpha-backend-cms-ms-v1-container
        ports:
        - containerPort: 3003
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z alpha-rabbitmq-service 5672; do echo waiting for rabbitmq ;
          sleep 2; done;
        image: busybox:1.28
        name: wait-for-rabbitmq
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-backend-health-ms-v1-deployment
  name: alpha-backend-health-ms-v1-deployment
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-backend-health-ms-v1-deployment
  template:
    metadata:
      labels:
        app: alpha-backend-health-ms-v1-deployment
    spec:
      containers:
      - env:
        - name: NODE_ENV
          value: local
        - name: PORT
          value: "3004"
        - name: APP_NAME
          value: alpha-health-ms-v1
        - name: APP_API_PREFIX
          value: /api/health-ms/v1
        - name: APP_DEBUG
          value: "true"
        - name: JWT_SECRET
          value: secret
        - name: JWT_EXPIRES_IN
          value: 1d
        - name: HEALTH_SERVICE_BASE_URL
          value: http://alpha-backend-user-ms-v1-service:3001
        - name: HEALTH_SERVICE_API_PREFIX
          value: /api/v1/health
        - name: DB_HOST
          value: alpha-postgressql.postgres.database.azure.com
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: alphaadmin
        - name: DB_PASSWORD
          value: alphaadminpasswd543
        - name: DB_NAME
          value: alpha_database
        - name: RABBITMQ_HOST
          value: alpha-rabbitmq-service
        - name: RABBITMQ_PORT
          value: "5672"
        - name: RABBITMQ_USERNAME
          value: guest
        - name: RABBITMQ_PASSWORD
          value: guest
        - name: RABBITMQ_QUEUE
          value: health_queue
        image: alphadev.azurecr.io/alpha-backend-health-ms-v1@sha256:31dfe5cab455c9db3bfb5b955571fd4de520864feb9d8bc0f66bafa4c557c074
        imagePullPolicy: IfNotPresent
        name: alpha-backend-health-ms-v1-container
        ports:
        - containerPort: 3004
        resources:
          limits:
            cpu: 150m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 150m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z alpha-rabbitmq-service 5672; do echo waiting for rabbitmq ;
          sleep 2; done;
        image: busybox:1.28
        name: wait-for-rabbitmq
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-backend-notification-ms-v1-deployment
  name: alpha-backend-notification-ms-v1-deployment
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-backend-notification-ms-v1-deployment
  template:
    metadata:
      labels:
        app: alpha-backend-notification-ms-v1-deployment
    spec:
      containers:
      - env:
        - name: NODE_ENV
          value: local
        - name: PORT
          value: "3002"
        - name: APP_NAME
          value: alpha-notification-ms-v1
        - name: APP_API_PREFIX
          value: /api/notification-ms/v1
        - name: APP_DEBUG
          value: "true"
        - name: JWT_SECRET
          value: secret
        - name: JWT_EXPIRES_IN
          value: 1d
        - name: HEALTH_SERVICE_BASE_URL
          value: http://alpha-backend-user-ms-v1-service:3001
        - name: HEALTH_SERVICE_API_PREFIX
          value: /api/v1/health
        - name: DB_HOST
          value: alpha-postgressql.postgres.database.azure.com
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: alphaadmin
        - name: DB_PASSWORD
          value: alphaadminpasswd543
        - name: DB_NAME
          value: alpha_database
        - name: RABBITMQ_HOST
          value: alpha-rabbitmq-service
        - name: RABBITMQ_PORT
          value: "5672"
        - name: RABBITMQ_USERNAME
          value: guest
        - name: RABBITMQ_PASSWORD
          value: guest
        - name: RABBITMQ_QUEUE
          value: notification_queue
        - name: SENDGRID_API_KEY
          value: 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
        - name: SENDGRID_FROM_NAME
          value: Aster Admin
        - name: SENDGRID_FROM_EMAIL
          value: admin@astercircular.co
        image: alphadev.azurecr.io/alpha-backend-notification-ms-v1@sha256:f3887993c92731b67cdd87de3ec1e8f3f27fe6d1295d70e1c59ffca929b7fddd
        imagePullPolicy: IfNotPresent
        name: alpha-backend-notification-ms-v1-container
        ports:
        - containerPort: 3002
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z alpha-rabbitmq-service 5672; do echo waiting for rabbitmq ;
          sleep 2; done;
        image: busybox:1.28
        name: wait-for-rabbitmq
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-backend-user-ms-v1-deployment
  name: alpha-backend-user-ms-v1-deployment
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-backend-user-ms-v1-deployment
  template:
    metadata:
      labels:
        app: alpha-backend-user-ms-v1-deployment
    spec:
      containers:
      - env:
        - name: NODE_ENV
          value: local
        - name: PORT
          value: "3001"
        - name: APP_NAME
          value: alpha-user-ms-v1
        - name: APP_API_PREFIX
          value: /api/user-ms/v1
        - name: APP_DEBUG
          value: "true"
        - name: JWT_SECRET
          value: secret
        - name: JWT_EXPIRES_IN
          value: 1d
        - name: HEALTH_SERVICE_BASE_URL
          value: http://alpha-backend-user-ms-v1-service:3001
        - name: HEALTH_SERVICE_API_PREFIX
          value: /api/v1/health
        - name: DB_HOST
          value: alpha-postgressql.postgres.database.azure.com
        - name: DB_PORT
          value: "5432"
        - name: DB_USER
          value: alphaadmin
        - name: DB_PASSWORD
          value: alphaadminpasswd543
        - name: DB_NAME
          value: alpha_database
        - name: RABBITMQ_HOST
          value: alpha-rabbitmq-service
        - name: RABBITMQ_PORT
          value: "5672"
        - name: RABBITMQ_USERNAME
          value: guest
        - name: RABBITMQ_PASSWORD
          value: guest
        - name: RABBITMQ_QUEUE
          value: user_queue
        image: alphadev.azurecr.io/alpha-backend-user-ms-v1@sha256:61f61f75eb51376c9200297cb29b867dc1e0e0c705ab26e4345ec01da9eb3105
        imagePullPolicy: IfNotPresent
        name: alpha-backend-user-ms-v1-conatiner
        ports:
        - containerPort: 3001
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: 0.5Gi
            memory: 0.5Gi
      initContainers:
      - command:
        - sh
        - -c
        - until nc -z alpha-rabbitmq-service 5672; do echo waiting for rabbitmq ;
          sleep 2; done;
        image: busybox:1.28
        name: wait-for-rabbitmq
        resources:
          limits:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
          requests:
            cpu: 250m
            ephemeral-storage: .5Gi
            memory: 0.5Gi
---
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: alpha-rabbitmq
  name: alpha-rabbitmq
  namespace: alpha
spec:
  selector:
    matchLabels:
      app: alpha-rabbitmq
  template:
    metadata:
      labels:
        app: alpha-rabbitmq
    spec:
      containers:
      - env:
        - name: RABBITMQ_DEFAULT_USER
          value: guest
        - name: RABBITMQ_DEFAULT_PASS
          value: guest
        image: rabbitmq:3
        name: alpha-rabbitmq-container
        ports:
        - containerPort: 5672
      hostname: alpha-rabbitmq
